# 싱크홀 안전도 서비스(Sinkhole Safety Service)

## 프로젝트 요약

싱크홀 안전도 서비스 프로젝트는 서울시 내의 싱크홀(지반 침하) 위험 지역을 시각적으로 확인할 수 있는 웹 기반 경보 시스템이다. 
사용자는 웹 지도(UI)를 통해 서울시 전역을 탐색할 수 있으며 지도를 확대하거나 축소하면 해당 구 또는 동 단위로 세분화된 위험도 정보가 원의 형태로 표시된다. 각 원의 크기와 색상은 위험 수준에 따라 달라지며 지도의 확대 비율에 따라 자동으로 범위가 조정된다. 또한 사용자는 검색 기능을 통해 구 또는 동을 선택하면 해당 지역 지도로 이동해 위험도를 바로 확인할 수 있다. 시스템은 인터넷에 공개된 싱크홀 발생 이력 데이터를 기준으로 위험 지역을 시각화하며 최근 발생 지역은 공지사항 형태로 표시된다. GPS 기능을 활용해 사용자의 현재 위치를 가져오고 만약 사용자가 위험 지역 반경 내에 있을 경우 경고 알람을 표시하여 실시간으로 안전을 안내한다. 본 서비스는 시민들이 생활 속에서 지반 안전 정보를 직관적으로 확인하고 싱크홀 사고 예방에 도움을 주는 것을 목표로 하고있다.

<img width="2880" height="1519" alt="map2" src="https://github.com/user-attachments/assets/69de6868-f970-42dd-8f3e-8fe527b14e24" />
<img src="https://github.com/user-attachments/assets/f524d311-e47c-489c-86e3-199e68584d45" width="500" />

---

## 기능 구성요소
1. **행정구 위험도 시각화**
	- Leaflet.js 기반 대화형 지도
   	- 구/동 단위 위험도 원형 표시
   	- 등급(A~E)별 색상 구분 (초록→노랑→주황→빨강)
   	- 클릭 시 상세 패널 표시 (등급/점수/사고 목록)
   	- 실시간 API 연동으로 최신 데이터 반영
2. **행정구 검색 기능**
	- 구/동 이름 검색 (자동완성)
	- 선택 시 해당 지역으로 지도 이동
	- 주소 기반 좌표 변환 (Geocoding)
3. **실시간 싱크홀 사고 공지**
	- 국토교통부 사고 데이터 실시간 조회
	- 최신 공지 리스트 (제목/날짜/위치/상세내용)
	- 서울시 사고만 필터링
4. **안전등급 상세 패널**
	- 선택된 지역의 등급/점수 표시
 	- 산출 근거 및 사고 이력 제공
 	- 실시간 업데이트

---

## 안전등급 기준 (2025.12.15 기준)

### 📊 등급 체계 (국토교통부 표준 준용)

| 등급 | 점수 범위 | Danger 레벨 | 지도 색상 | 의미 |
|:----:|:---------:|:-----------:|:---------:|------|
| **A** | 80~100점 | 1 | 🟢 초록색 | **매우 안전** - 최근 사고 거의 없음 |
| **B** | 60~79점 | 2 | 🟡 노란색 | **안전** - 사고 이력 적음 |
| **C** | 40~59점 | 3 | 🟠 주황색 | **보통** - 주의 필요 |
| **D** | 20~39점 | 4 | 🔴 빨간색 | **위험** - 즉각 조치 필요 |
| **E** | 0~19점 | 5 | 🔴 진한빨강 | **매우 위험** - 긴급 대응 필요 |

> **점수 기준**: 높을수록 안전, 낮을수록 위험

### 🔢 점수 계산 방식

#### 1. 데이터 출처
- **국토교통부 재난안전데이터 공개 API** (DSSP-IF-00754)
- 서울특별시 지반침하(싱크홀) 실제 사고 발생 기록
- 1시간마다 자동 캐시 갱신

#### 2. 사고 시간 가중치

| 사고 발생 시기 | 위험도 점수 | 설명 |
|---------------|-----------|------|
| **1개월 이내** | 30점 | 최근 사고 - 최고 위험 |
| **3개월 이내** | 25점 | 비교적 최근 |
| **6개월 이내** | 20점 | 중간 수준 |
| **1년 이내** | 15점 | 작년 내 발생 |
| **2년 이내** | 10점 | 오래된 사고 |
| **2년 이상** | 5점 | 매우 오래된 사고 |

#### 3. 추가 가중치
- **위치 정확도 보너스**: 해당 구 정확 매칭 시 **×1.5배**
- **건수 보너스**: `min(40, 사고건수 × 3)`
  - 사고 1건당 3점 추가 (최대 40점)

#### 4. 최종 점수 변환 공식

```javascript
// 1단계: 위험도 점수 계산
위험도점수 = Σ(사고별 시간가중치 × 위치보너스) + 건수보너스

// 2단계: 안전도 점수로 변환 (비선형)
if (위험도점수 <= 20)
    안전점수 = 100 - (위험도점수 × 2)      // 0~20 → 100~60점
else if (위험도점수 <= 40)
    안전점수 = 60 - ((위험도점수 - 20) × 1.5)  // 20~40 → 60~30점
else
    안전점수 = 30 - ((위험도점수 - 40) × 0.5)  // 40~100 → 30~0점

// 3단계: 점수 → 등급 변환
80~100점 → A등급 (Danger 1)
60~79점  → B등급 (Danger 2)
40~59점  → C등급 (Danger 3)
20~39점  → D등급 (Danger 4)
0~19점   → E등급 (Danger 5)
```

### 📈 계산 예시

#### 예시 1: 사고 없는 지역 (대부분의 경우)
```
사고 건수: 0건
→ 위험점수 = 0
→ 안전점수 = 100
→ 결과: A등급 (매우 안전)
```

#### 예시 2: 최근 1개월 사고 1건
```
사고: 1건 (1개월 이내, 해당 구 매칭)
→ 위험점수 = 30×1.5 + 3 = 48점
→ 안전점수 = 30 - (48-40)×0.5 = 26점
→ 결과: D등급 (위험)
```

#### 예시 3: 오래된 사고 여러 건
```
사고: 10건 (모두 2년 이상)
→ 위험점수 = (5×10) + (10×3) = 80점
→ 안전점수 = 30 - (80-40)×0.5 = 10점
→ 결과: E등급 (매우 위험)
```

### 🎯 등급 결정 주요 요소

| 요소 | 영향도 | 설명 |
|------|:-----:|------|
| **최근성** | ⭐⭐⭐⭐⭐ | 1개월 내 사고 = 30점 (가장 중요) |
| **건수** | ⭐⭐⭐ | 사고 많을수록 위험 (최대 40점) |
| **위치 정확도** | ⭐⭐ | 해당 구 포함 시 1.5배 가중 |
| **오래된 사고** | ⭐ | 2년 이상 사고는 5점만 부여 |

### 📝 참고 사항
- 국토교통부 지반침하위험도평가 API(`getSubsidenceEvalutionList01`) 승인 시 공식 등급 자동 전환
- 현재는 사고 이력 데이터를 기반으로 한 프록시(대체) 점수 사용
- 점수 산출 알고리즘은 실제 사고 패턴 분석을 통해 지속 개선 예정


---

## 데이터 출처
- **[국토교통부 재난안전데이터 공개 API](https://www.safetydata.go.kr/)**
  - `DSSP-IF-00754`: 지반침하사고 목록 (서울시 필터 적용)
  - `DSSP-IF-00752`: 지반침하 위험도 평가 (승인 대기 중)
- **[서울 열린데이터광장](https://data.seoul.go.kr/)**
  - 행정동 경계 GeoJSON
  - 도로함몰 현황 (참고용)
- **[공공데이터포털](https://www.data.go.kr/)**
  - 지하공사정보
  - 도로 점검 이력

---

## 프론트엔드 지도 구성
- **사용 기술:** Leaflet.js, React(Next.js), TypeScript  
- **기본 중심 좌표:** 서울시청 (37.5665, 126.9780)  
- **구현 파일 구조:**
  - `Map.tsx`: 서울 중심 지도 렌더링 및 폴리곤 표시  
  - `SearchBox.tsx`: 행정동 검색 및 지도 이동  
  - `InfoPanel.tsx`: 선택된 동의 등급·공지 정보 표시  
- **지도 타일:** OpenStreetMap Tiles API  
- **추가 계획:** 색약 모드 지원 / 히트맵 시각화 / 오프라인 캐싱  

---

## 역할 분담
| 이름 | 담당 역할 | 주요 업무 |
|------|------------|------------|
| **하준서** | 백엔드 | Node.js, Express 서버 구축, 데이터 처리, 외부 API 연동 |
| **문은서** | 프론트엔드 / 백엔드 보조 | README/문서화, 안전등급 유틸, 지도 UI 보조 |
| **곽수민** | 프론트엔드 |  React UI/UX 개발, Leaflet 지도 구현, 인터페이스 디자인 개선|

## 🛠️ 사용 기술 목록 (예정)

Node.js, Express, React, JavaScript, HTML, CSS, Render, Leaflet.js, TypeScript

## 🗓️ 프로젝트 일정

| 기간 | 주요 내용 |
|------|------------|
| 10/28 ~ 11/9 | 서버 구축 및 초기 환경 설 |
| 11/10 ~ 11/16 | 지도 구성, 검색 기능 추가, 기본 UI 구성 |
| 11/17 ~ 11/30 |구체적 UI 구성 및 기능 추가(싱크홀 발생 공지사항, 행정구동에 따른 위치 검색) |
| 12/2 ~ 12/17 | 데이터 통계 시각화 정리 및 최종 배포 |

---

## 💡 향후 개선 방향
- 색약 사용자 위한 접근성 모드 추가  
- 모바일 성능 최적화 (지도 캐싱 / 오프라인 모드)  
- 이동 경로 기반 위험도 안내 기능 추가  
- 향후 앱(App) 버전 확장 검토  

---

## v0.3.0 마일스톤
- 백엔드: 국토교통부 재난안전데이터 오픈API 연동
	- `DSSP-IF-00752` 지반침하 위험도 평가
	- `DSSP-IF-00754` 지반침하사고 목록 (서울시 필터 적용)
- 프론트엔드: InfoPanel에서 공지사항 실데이터 로딩 및 선택된 구/동 기준 필터링

## 로컬 실행 방법
- 요구사항: Node.js 18+ / npm
- 설치:
	- 프로젝트 루트: `npm install`
	- 백엔드: `cd backend && npm install`
	- 프론트엔드: `cd ../frontend && npm install`
- 환경변수:
	- `backend/.env` 파일 생성
		- `MOLIT_RISK_API_KEY` (DSSP-IF-00752)
		- `MOLIT_ACCIDENT_API_KEY` (DSSP-IF-00754)
		- `MOLIT_UNDERGROUND_API_KEY` (옵션)

### 1. 안전도 조회
```
GET /api/safety?gu=강남구&dong=역삼동
```
**응답 예시:**
```json
{
  "location": { "gu": "강남구", "dong": "역삼동" },
  "score": 78상세

### 동작 원리
1. **사고 데이터 수집**: 국토교통부 API에서 서울시 사고 목록 조회 (최대 100건)
2. **지역 필터링**: 요청된 구/동과 매칭되는 사고만 추출
3. **시간 가중치 계산**: 각 사고의 발생일로부터 경과 일수에 따라 점수 부여
4. **건수 보너스 추가**: 총 사고 건수에 비례한 추가 점수
5. **비선형 변환**: 위험도 점수를 안전도 점수로 역변환
6. **등급 결정**: 최종 점수를 A~E 등급으로 분류

### 장점
- ✅ 실제 사고 데이터 기반 계산
- ✅ 최근 사고에 더 높은 가중치
- ✅ 지역별 차별화된 등급
- ✅ 1시간 캐시로 성능 최적화

### 제한사항
- ⚠️ 공식 위험도 평가 API 승인 대기 중 (대체 방안)
- ⚠️ 사고 보고 누락 시 과소평가 가능
- ⚠️ 지역 매칭 정확도에 따라 편차 존재
  "basis": {
    "window": "accidents-1y",
    "fields_used": { "notices": true },
    "updated_at": "2025-12-15T10:30:00.000Z",
    "data_source": "proxy:notices"
  }
}
```

### 2. 사고 공지 조회
```
GET /api/notices?limit=10
```
**응답 예시:**
```json
[
  {
    "id": "20180014",
    "title": "종로구 지반침하 사고",
    "date": "2018-09-04",
    "location": "서울특별시 종로구",
    "description": "상수도관 및 통신관 매설 시 하수관로 파손 추정",
    "source": "국토교통부"
  }
]
```

### 3. 지역 목록 조회
```
GET /api/districts
```

### 4. 주소 → 좌표 변환
```
GET /api/geocode?q=서울시+강남구+역삼동
```

### 5. 벌크 안전도 조회 (내부용)
```
POST /api/safety-bulk
{
  "locations": [
    { "gu": "강남구", "dong": "역삼동" },
    { "gu": "송파구", "dong": "잠실동" }
  ]
}
```

## 백엔드 API 엔드포인트
- `GET /api/safety?gu=강남구&dong=역삼동` — 해당 지역 위험도 점수/등급
	- 현재는 사고 데이터(국토부 DSSP-IF-00754)를 이용한 프록시 점수로 동작합니다.
	- MOLIT 지반침하위험도평가(`undergroundsafetyinfo01/getSubsidenceEvalutionList01`) 승인/활성화 후 자동으로 공식 점수를 사용합니다.
- `GET /api/notices?limit=5` — 최근 지반침하 사고 목록(서울 필터)
- `GET /api/districts` — 샘플 지구 폴리곤(구성되어 있을 경우)

## 프록시 점수 산출 기준
- 최근 사고일수 역가중: 최근일수에 비례하여 가중치를 높임
- 건수 합산: 동일 구/동 관련 사고가 많을수록 위험도 증가
- 구 단위 보강: 동 매칭이 적은 경우 구 단위로 집계하여 안정적으로 점수 제공

## 다음 단계
- 공식 위험도 API 승인 후 자동 전환(파라미터: `pageNo`, `numOfRows`, `type/json`, `startYmd`, `endYmd` 유지)
- 지도 클릭 시 Safety API 반영 확인 및 히트맵 튜닝
- E2E 체크리스트 수행: 검색→선택→지도/히트맵→정보→공지 흐름 검증
